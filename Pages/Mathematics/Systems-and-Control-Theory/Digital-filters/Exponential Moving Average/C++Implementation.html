<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head>
    <meta charset="UTF-8">
    <meta name="author" content="Pieter P">
    <link rel="stylesheet" type="text/css" href="/CSS/Pages.css">
    <link href="/CSS/roboto.css" rel="stylesheet" type="text/css">
    <link href="/CSS/icon.css" rel="stylesheet" type="text/css">
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } },
            "fast-preview": {
            disabled: true
            }
        });
    </script>
    <script type="text/javascript" src="/MathJax/MathJax.js?config=TeX-AMS_SVG"></script>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta name="theme-color" content="#ccc">
    <meta name="keywords" content="EMA, Exponential Moving Average, IIR filter, filters, DSP, C++, implementation, algorithm">
    <meta name="description" content="A very fast and efficient Exponential Moving Average implementation in C++.">
    <title>C++ Implementation</title>
<style type="text/css">.mjx-chtml {display: inline-block; line-height: 0; text-indent: 0; text-align: left; text-transform: none; font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; letter-spacing: normal; word-wrap: normal; word-spacing: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; margin: 0; padding: 1px 0}
.MJXc-display {display: block; text-align: center; margin: 1em 0; padding: 0}
.mjx-chtml[tabindex]:focus, body :focus .mjx-chtml[tabindex] {display: inline-table}
.mjx-full-width {text-align: center; display: table-cell!important; width: 10000em}
.mjx-math {display: inline-block; border-collapse: separate; border-spacing: 0}
.mjx-math * {display: inline-block; -webkit-box-sizing: content-box!important; -moz-box-sizing: content-box!important; box-sizing: content-box!important; text-align: left}
.mjx-numerator {display: block; text-align: center}
.mjx-denominator {display: block; text-align: center}
.MJXc-stacked {height: 0; position: relative}
.MJXc-stacked > * {position: absolute}
.MJXc-bevelled > * {display: inline-block}
.mjx-stack {display: inline-block}
.mjx-op {display: block}
.mjx-under {display: table-cell}
.mjx-over {display: block}
.mjx-over > * {padding-left: 0px!important; padding-right: 0px!important}
.mjx-under > * {padding-left: 0px!important; padding-right: 0px!important}
.mjx-stack > .mjx-sup {display: block}
.mjx-stack > .mjx-sub {display: block}
.mjx-prestack > .mjx-presup {display: block}
.mjx-prestack > .mjx-presub {display: block}
.mjx-delim-h > .mjx-char {display: inline-block}
.mjx-surd {vertical-align: top}
.mjx-surd + .mjx-box {display: inline-flex}
.mjx-mphantom * {visibility: hidden}
.mjx-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 2px 3px; font-style: normal; font-size: 90%}
.mjx-annotation-xml {line-height: normal}
.mjx-menclose > svg {fill: none; stroke: currentColor; overflow: visible}
.mjx-mtr {display: table-row}
.mjx-mlabeledtr {display: table-row}
.mjx-mtd {display: table-cell; text-align: center}
.mjx-label {display: table-row}
.mjx-box {display: inline-block}
.mjx-block {display: block}
.mjx-span {display: inline}
.mjx-char {display: block; white-space: pre}
.mjx-itable {display: inline-table; width: auto}
.mjx-row {display: table-row}
.mjx-cell {display: table-cell}
.mjx-table {display: table; width: 100%}
.mjx-line {display: block; height: 0}
.mjx-strut {width: 0; padding-top: 1em}
.mjx-vsize {width: 0}
.MJXc-space1 {margin-left: .167em}
.MJXc-space2 {margin-left: .222em}
.MJXc-space3 {margin-left: .278em}
.mjx-test.mjx-test-display {display: table!important}
.mjx-test.mjx-test-inline {display: inline!important; margin-right: -1px}
.mjx-test.mjx-test-default {display: block!important; clear: both}
.mjx-ex-box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60ex}
.mjx-test-inline .mjx-left-box {display: inline-block; width: 0; float: left}
.mjx-test-inline .mjx-right-box {display: inline-block; width: 0; float: right}
.mjx-test-display .mjx-right-box {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MJXc-TeX-unknown-R {font-family: monospace; font-style: normal; font-weight: normal}
.MJXc-TeX-unknown-I {font-family: monospace; font-style: italic; font-weight: normal}
.MJXc-TeX-unknown-B {font-family: monospace; font-style: normal; font-weight: bold}
.MJXc-TeX-unknown-BI {font-family: monospace; font-style: italic; font-weight: bold}
.MJXc-TeX-ams-R {font-family: MJXc-TeX-ams-R,MJXc-TeX-ams-Rw}
.MJXc-TeX-cal-B {font-family: MJXc-TeX-cal-B,MJXc-TeX-cal-Bx,MJXc-TeX-cal-Bw}
.MJXc-TeX-frak-R {font-family: MJXc-TeX-frak-R,MJXc-TeX-frak-Rw}
.MJXc-TeX-frak-B {font-family: MJXc-TeX-frak-B,MJXc-TeX-frak-Bx,MJXc-TeX-frak-Bw}
.MJXc-TeX-math-BI {font-family: MJXc-TeX-math-BI,MJXc-TeX-math-BIx,MJXc-TeX-math-BIw}
.MJXc-TeX-sans-R {font-family: MJXc-TeX-sans-R,MJXc-TeX-sans-Rw}
.MJXc-TeX-sans-B {font-family: MJXc-TeX-sans-B,MJXc-TeX-sans-Bx,MJXc-TeX-sans-Bw}
.MJXc-TeX-sans-I {font-family: MJXc-TeX-sans-I,MJXc-TeX-sans-Ix,MJXc-TeX-sans-Iw}
.MJXc-TeX-script-R {font-family: MJXc-TeX-script-R,MJXc-TeX-script-Rw}
.MJXc-TeX-type-R {font-family: MJXc-TeX-type-R,MJXc-TeX-type-Rw}
.MJXc-TeX-cal-R {font-family: MJXc-TeX-cal-R,MJXc-TeX-cal-Rw}
.MJXc-TeX-main-B {font-family: MJXc-TeX-main-B,MJXc-TeX-main-Bx,MJXc-TeX-main-Bw}
.MJXc-TeX-main-I {font-family: MJXc-TeX-main-I,MJXc-TeX-main-Ix,MJXc-TeX-main-Iw}
.MJXc-TeX-main-R {font-family: MJXc-TeX-main-R,MJXc-TeX-main-Rw}
.MJXc-TeX-math-I {font-family: MJXc-TeX-math-I,MJXc-TeX-math-Ix,MJXc-TeX-math-Iw}
.MJXc-TeX-size1-R {font-family: MJXc-TeX-size1-R,MJXc-TeX-size1-Rw}
.MJXc-TeX-size2-R {font-family: MJXc-TeX-size2-R,MJXc-TeX-size2-Rw}
.MJXc-TeX-size3-R {font-family: MJXc-TeX-size3-R,MJXc-TeX-size3-Rw}
.MJXc-TeX-size4-R {font-family: MJXc-TeX-size4-R,MJXc-TeX-size4-Rw}
.MJXc-TeX-vec-R {font-family: MJXc-TeX-vec-R,MJXc-TeX-vec-Rw}
.MJXc-TeX-vec-B {font-family: MJXc-TeX-vec-B,MJXc-TeX-vec-Bx,MJXc-TeX-vec-Bw}
@font-face {font-family: MJXc-TeX-ams-R; src: local('MathJax_AMS'), local('MathJax_AMS-Regular')}
@font-face {font-family: MJXc-TeX-ams-Rw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_AMS-Regular.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-cal-B; src: local('MathJax_Caligraphic Bold'), local('MathJax_Caligraphic-Bold')}
@font-face {font-family: MJXc-TeX-cal-Bx; src: local('MathJax_Caligraphic'); font-weight: bold}
@font-face {font-family: MJXc-TeX-cal-Bw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Caligraphic-Bold.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Bold.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-frak-R; src: local('MathJax_Fraktur'), local('MathJax_Fraktur-Regular')}
@font-face {font-family: MJXc-TeX-frak-Rw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Fraktur-Regular.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Fraktur-Regular.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-frak-B; src: local('MathJax_Fraktur Bold'), local('MathJax_Fraktur-Bold')}
@font-face {font-family: MJXc-TeX-frak-Bx; src: local('MathJax_Fraktur'); font-weight: bold}
@font-face {font-family: MJXc-TeX-frak-Bw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Fraktur-Bold.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Fraktur-Bold.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-math-BI; src: local('MathJax_Math BoldItalic'), local('MathJax_Math-BoldItalic')}
@font-face {font-family: MJXc-TeX-math-BIx; src: local('MathJax_Math'); font-weight: bold; font-style: italic}
@font-face {font-family: MJXc-TeX-math-BIw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Math-BoldItalic.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Math-BoldItalic.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Math-BoldItalic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-R; src: local('MathJax_SansSerif'), local('MathJax_SansSerif-Regular')}
@font-face {font-family: MJXc-TeX-sans-Rw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Regular.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Regular.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-B; src: local('MathJax_SansSerif Bold'), local('MathJax_SansSerif-Bold')}
@font-face {font-family: MJXc-TeX-sans-Bx; src: local('MathJax_SansSerif'); font-weight: bold}
@font-face {font-family: MJXc-TeX-sans-Bw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Bold.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Bold.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-I; src: local('MathJax_SansSerif Italic'), local('MathJax_SansSerif-Italic')}
@font-face {font-family: MJXc-TeX-sans-Ix; src: local('MathJax_SansSerif'); font-style: italic}
@font-face {font-family: MJXc-TeX-sans-Iw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Italic.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Italic.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-script-R; src: local('MathJax_Script'), local('MathJax_Script-Regular')}
@font-face {font-family: MJXc-TeX-script-Rw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Script-Regular.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Script-Regular.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Script-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-type-R; src: local('MathJax_Typewriter'), local('MathJax_Typewriter-Regular')}
@font-face {font-family: MJXc-TeX-type-Rw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Typewriter-Regular.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Typewriter-Regular.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Typewriter-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-cal-R; src: local('MathJax_Caligraphic'), local('MathJax_Caligraphic-Regular')}
@font-face {font-family: MJXc-TeX-cal-Rw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Caligraphic-Regular.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-B; src: local('MathJax_Main Bold'), local('MathJax_Main-Bold')}
@font-face {font-family: MJXc-TeX-main-Bx; src: local('MathJax_Main'); font-weight: bold}
@font-face {font-family: MJXc-TeX-main-Bw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Main-Bold.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-I; src: local('MathJax_Main Italic'), local('MathJax_Main-Italic')}
@font-face {font-family: MJXc-TeX-main-Ix; src: local('MathJax_Main'); font-style: italic}
@font-face {font-family: MJXc-TeX-main-Iw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Main-Italic.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-R; src: local('MathJax_Main'), local('MathJax_Main-Regular')}
@font-face {font-family: MJXc-TeX-main-Rw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Main-Regular.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-math-I; src: local('MathJax_Math Italic'), local('MathJax_Math-Italic')}
@font-face {font-family: MJXc-TeX-math-Ix; src: local('MathJax_Math'); font-style: italic}
@font-face {font-family: MJXc-TeX-math-Iw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Math-Italic.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size1-R; src: local('MathJax_Size1'), local('MathJax_Size1-Regular')}
@font-face {font-family: MJXc-TeX-size1-Rw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Size1-Regular.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size2-R; src: local('MathJax_Size2'), local('MathJax_Size2-Regular')}
@font-face {font-family: MJXc-TeX-size2-Rw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Size2-Regular.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size3-R; src: local('MathJax_Size3'), local('MathJax_Size3-Regular')}
@font-face {font-family: MJXc-TeX-size3-Rw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Size3-Regular.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size4-R; src: local('MathJax_Size4'), local('MathJax_Size4-Regular')}
@font-face {font-family: MJXc-TeX-size4-Rw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Size4-Regular.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-vec-R; src: local('MathJax_Vector'), local('MathJax_Vector-Regular')}
@font-face {font-family: MJXc-TeX-vec-Rw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Vector-Regular.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Vector-Regular.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Vector-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-vec-B; src: local('MathJax_Vector Bold'), local('MathJax_Vector-Bold')}
@font-face {font-family: MJXc-TeX-vec-Bx; src: local('MathJax_Vector'); font-weight: bold}
@font-face {font-family: MJXc-TeX-vec-Bw; src /*1*/: url('/MathJax/fonts/HTML-CSS/TeX/eot/MathJax_Vector-Bold.eot'); src /*2*/: url('/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Vector-Bold.woff') format('woff'), url('/MathJax/fonts/HTML-CSS/TeX/otf/MathJax_Vector-Bold.otf') format('opentype')}
</style></head>
<body>
    <nav>
        <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 48 48" style="position:absolute;top:4px;right: 4px;">
                <path d="M0 0h48v48h-48z" fill="none"></path>
                <path d="M6 36h36v-4h-36v4zm0-10h36v-4h-36v4zm0-14v4h36v-4h-36z"></path>
            </svg>
            <h2><a href="/Pages">Pages</a></h2>
<ul>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Raspberry-Pi/index.html">Raspberry Pi</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Raspberry-Pi/Installation+Setup/index.html">Installation and Setup</a>
        <ul>
            <li><span class="ftriangle"></span><a href="../../../../Raspberry-Pi/Installation+Setup/Setting-up-Ubuntu.html">Installing and Setting up Ubuntu</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Raspberry-Pi/Installation+Setup/WiFi-Setup.html">Setting up the WiFi Connection</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Raspberry-Pi/Python-Development/index.html">Python Development</a>
        <ul>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Raspberry-Pi/C++-Development/index.html">C++ Development</a>
        <ul>
            <li><span class="ftriangle"></span><a href="../../../../Raspberry-Pi/C++-Development/Installation.html">Installation and setup</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Raspberry-Pi/C++-Development/Building-The-Toolchain.html">Building the Cross-Compilation Toolchain</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Raspberry-Pi/C++-Development/Dependencies.html">Cross-Compiling the Dependencies</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Raspberry-Pi/C++-Development/Installing-Dependencies.html">Installing the dependencies on the Pi</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Raspberry-Pi/C++-Development/Editor-Setup.html">Setting up Visual Studio Code for C++ Development</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Raspberry-Pi/C++-Development/Cpp-Program.html">Cross-Compiling the C++ Example Project</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Raspberry-Pi/C++-Development/Speedrun.html">Speedrun</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Raspberry-Pi/NEON/index.html">NEON</a>
        <ul>
            <li><span class="ftriangle"></span><a href="../../../../Raspberry-Pi/NEON/Division.html">Division</a></li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Arduino/index.html">Arduino</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Arduino/Audio-and-Signal-Processing/index.html">Audio and Signal Processing</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Arduino/Audio-and-Signal-Processing/VU-Meters/index.html">VU Meters</a>
            <ul>
            </ul>
            </li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Arduino/Control-Surface/index.html">Control Surface</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Arduino/Control-Surface/Developers/index.html">Developers</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../../../Arduino/Control-Surface/Developers/Installation.html">Installation</a></li>
                <li><span class="ftriangle"></span><a href="../../../../Arduino/Control-Surface/Developers/Style.html">Style</a></li>
                <li><span class="ftriangle"></span><a href="../../../../Arduino/Control-Surface/Developers/Tests.html">Tests</a></li>
                <li><span class="ftriangle"></span><a href="../../../../Arduino/Control-Surface/Developers/Generating-Documentation.html">Generating Documentation</a></li>
            </ul>
            </li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Arduino/Bootloaders/index.html">Bootloaders</a>
        <ul>
            <li><span class="ftriangle"></span><a href="../../../../Arduino/Bootloaders/ATmega328P-custom-frequency.html">Compiling Optiboot - ATmega328P at custom frequency</a></li>
        </ul>
        </li>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Arduino/ESP8266/index.html">ESP8266</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Arduino/ESP8266/Flashing/index.html">Flashing</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../../../Arduino/ESP8266/Flashing/Flashing-With-an-Arduino.html">Flashing the ESP8266 with an Arduino UNO</a></li>
            </ul>
            </li>
        </ul>
        </li>
    </ul>
    </li>
    <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../index.html">Mathematics</a>
    <ul>
        <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../index.html">Systems and Control Theory</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../Analog-Filters/index.html">Analog Filters &amp; Systems</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../Analog-Filters/Butterworth-Filters.html">Butterworth Filters</a></li>
            </ul>
            </li>
            <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../index.html">Digital Filters &amp; Systems</a>
            <ul>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/index.html">DTLTI Systems, Transfer Functions, and the Z-transform</a>
                <ul>
                    <li><span class="ftriangle"></span><a href="../DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/DTLTI-Systems.html">DTLTI Systems</a></li>
                    <li><span class="ftriangle"></span><a href="../DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/Impulse-and-Step-Response.html">Impulse and Step Response</a></li>
                    <li><span class="ftriangle"></span><a href="../DTLTI-Systems,-Transfer-Functions,-and-the-Z-transform/The-Z-transform.html">The Z-transform</a></li>
                </ul>
                </li>
                <li class="expanded"><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="index.html">Exponential Moving Average</a>
                <ul>
                    <li><span class="ftriangle"></span><a href="Exponential-Moving-Average.html">Exponential Moving Average</a></li>
                    <li><span class="ftriangle"></span><a href="Filtering-in-MATLAB.html">Filtering in MATLAB</a></li>
                    <li><span class="ftriangle"></span><a class="openEntry" href="C++Implementation.html">C++ Implementation</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../Simple Moving Average/index.html">Simple Moving Average</a>
                <ul>
                    <li><span class="ftriangle"></span><a href="../Simple Moving Average/Simple-Moving-Average.html">Simple Moving Average</a></li>
                    <li><span class="ftriangle"></span><a href="../Simple Moving Average/C++Implementation.html">C++ Implementation</a></li>
                </ul>
                </li>
                <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../Discretization/index.html">Discretization</a>
                <ul>
                    <li><span class="ftriangle"></span><a href="../Discretization/Bilinear-transform.html">Bilinear Transform</a></li>
                    <li><span class="ftriangle"></span><a href="../Discretization/Discretization-of-a-fourth-order-Butterworth-filter.html">Discretization of a Fourth-Order Butterworth Filter</a></li>
                </ul>
                </li>
                <li><span class="ftriangle"></span><a href="../FIR-Notch.html">Simple Finite Impulse Response Notch Filter</a></li>
            </ul>
            </li>
        </ul>
        </li>
    </ul>
    </li>
    <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Ubuntu/index.html">Ubuntu</a>
    <ul>
        <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Ubuntu/Software-Installation/index.html">Software Installation</a>
        <ul>
            <li><span class="dtriangle" onclick="this.parentElement.classList.toggle('expanded');"></span><a href="../../../../Ubuntu/Software-Installation/Arduino/index.html">Arduino</a>
            <ul>
                <li><span class="ftriangle"></span><a href="../../../../Ubuntu/Software-Installation/Arduino/Arduino-IDE.html">Arduino IDE</a></li>
                <li><span class="ftriangle"></span><a href="../../../../Ubuntu/Software-Installation/Arduino/Hairless-MIDI.html">The Hairless MIDI to Serial Bridge</a></li>
            </ul>
            </li>
            <li><span class="ftriangle"></span><a href="../../../../Ubuntu/Software-Installation/Installing-Locally.html">Installing Locally</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Ubuntu/Software-Installation/BlueZ.html">BlueZ with MIDI over BLE Support</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Ubuntu/Software-Installation/Doxygen.html">Doxygen</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Ubuntu/Software-Installation/Eclipse.html">Eclipse</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Ubuntu/Software-Installation/Eigen3.html">Eigen</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Ubuntu/Software-Installation/GoogleTest.html">GoogleTest</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Ubuntu/Software-Installation/Java.html">Java</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Ubuntu/Software-Installation/Python.html">Python</a></li>
            <li><span class="ftriangle"></span><a href="../../../../Ubuntu/Software-Installation/VirtualBox.html">VirtualBox</a></li>
        </ul>
        </li>
    </ul>
    </li>
</ul>

            <i class="material-icons">
                <a href="/" title="Home">home</a>
            </i>
            <i class="material-icons">
                <a href="C++Implementation.pdf" title="Download as PDF">get_app</a>
            </i>
            <i class="material-icons">
                <a href="javascript:window.print()" title="Print this article">print</a>
            </i>
            <i class="material-icons">
                <a href="https://github.com/tttapa/tttapa.github.io/issues/new" target="_blank" title="Comment or open an issue">feedback</a>
            </i>
        </div>
    </nav>
    <article>
        <h1 class="title">C++ Implementation</h1>
        <i class="author">Pieter P</i>
        <div>
<div class="toc" id="toc">
  <script>
  function updateTocSize() {
    let toc = document.getElementById("toc");
    toc.style.maxHeight = toc.scrollHeight + 'px';
  }
  </script>  <h4 class="toc" onclick="if (this.parentElement.classList.toggle('expanded')) {updateTocSize();window.addEventListener('resize', updateTocSize);} else {this.parentElement.style = undefined;window.removeEventListener('resize', updateTocSize);}">Table of Contents <i class="material-icons">list</i></h4>
  <ul>
            <li><a href="#dividing-by-powers-of-2">Dividing by Powers of 2</a></li>
              <ul>
                <li><a href="#negative-numbers">Negative Numbers</a></li>
                <li><a href="#rounding">Rounding</a></li>
              </ul>
            <li><a href="#implementation-in-c">Implementation in C++</a></li>
            <li><a href="#signed-rounding-division">Signed Rounding Division</a></li>
              <ul>
                <li><a href="#implementation-of-signed-and-unsigned-division-by-a-multiple-of-two">Implementation of Signed and Unsigned Division by a Multiple of Two</a></li>
                <li><a href="#a-better-alternative-for-signed-division">A better alternative for signed division</a></li>
              </ul>
            <li><a href="#improved-c-implementation">Improved C++ implementation</a></li>
            <li><a href="#arduino-example">Arduino Example</a></li>
            <li><a href="#additional-resources">Additional resources</a></li>
            </ul>
        
  </div>


<h3><a name="dividing-by-powers-of-2" href="#dividing-by-powers-of-2">Dividing by Powers of 2</a></h3>
<p>
    The factor <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="\alpha"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">α</span></span></span></span></span></span> in the difference equation of the Exponential Moving
    Average filter is a number between zero and one. There are two main ways to
    implement this multiplication by <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="\alpha"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">α</span></span></span></span></span></span>: Either we use floating point
    numbers and calculate the multiplication directly, or we use integers, and
    express the multiplication as a division by <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="1/\alpha \gt 1"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">/</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">α</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">&gt;</span></span><span class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span>.<br>
    Both floating point multiplication and integer division are relatively
    expensive operations, especially on embedded devices or microcontrollers.
</p>
<p>
    We can, however, choose the value for <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="\alpha"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">α</span></span></span></span></span></span> in such a way that
    <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="1/\alpha = 2^k, k \in \mathbb{N}"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">/</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">α</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.144em; padding-bottom: 0.519em;">,</span></span><span class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">∈</span></span><span class="mjx-texatom MJXc-space3"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.446em; padding-bottom: 0.298em;">N</span></span></span></span></span></span></span></span>.<br>
    This is useful, because a division by a power of two can be replaced by a
    very fast right bitshift:
    <span class="mjpage mjpage__block"><span class="mjx-chtml MJXc-display" style="text-align: center;"><span class="mjx-math" aria-label=" \alpha \cdot x = \frac{x}{2^k} = x \gg k "><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">α</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.004em; padding-bottom: 0.298em;">⋅</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mfrac MJXc-space3"><span class="mjx-box MJXc-stacked" style="width: 1.104em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 1.104em; top: -1.144em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span></span><span class="mjx-denominator" style="width: 1.104em; bottom: -0.992em;"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 1.104em;" class="mjx-line"></span></span><span style="height: 2.135em; vertical-align: -0.992em;" class="mjx-vsize"></span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">≫</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span></span>
</p>
<p>
    We can now rewrite the difference equation of the EMA with this optimization
    in mind:
    <span class="mjpage mjpage__block"><span class="mjx-chtml MJXc-display" style="text-align: center;"><span class="mjx-math" aria-label=" \begin{split}
    y[n] &amp;= \alpha x[n] + (1 - \alpha) y[n-1] \\
    &amp;= y[n-1] + \alpha \left(x[n] - y[n-1]\right) \\
    &amp;= y[n-1] + \frac{x[n] - y[n-1]}{2^k} \\
    &amp;= y[n-1] + \left(x[n] - y[n-1]\right) \gg k
    \end{split} "><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mtable" style="vertical-align: -3.103em; padding: 0px 0.167em;"><span class="mjx-table"><span class="mjx-mtr" style="height: 1.225em;"><span class="mjx-mtd" style="padding: 0px 0px 0px 0px; text-align: right; width: 1.652em;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0px 0px 0px 0px; text-align: left; width: 15.11em;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">α</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">(</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">α</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">)</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 1.375em;"><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: left;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">α</span></span><span class="mjx-mrow MJXc-space1"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">(</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">)</span></span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 2.882em;"><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: 0.59em;"><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: left;"><span class="mjx-mrow"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mfrac MJXc-space2"><span class="mjx-box MJXc-stacked" style="width: 6.525em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 6.525em; top: -1.59em;"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span><span class="mjx-denominator" style="width: 6.525em; bottom: -0.992em;"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 6.525em;" class="mjx-line"></span></span><span style="height: 2.582em; vertical-align: -0.992em;" class="mjx-vsize"></span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 1.225em;"><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: left;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mrow MJXc-space2"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">(</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">)</span></span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">≫</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span></span></span>
</p>
<h4><a name="negative-numbers" href="#negative-numbers">Negative Numbers</a></h4>
<p>
    There's one caveat though: this doesn't work for negative numbers.
    For example, if we try to calculate the integer division <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="-15 / 4"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">15</span></span><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">/</span></span></span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span></span></span></span></span> using
    this method, we get the following answer:
    <span class="mjpage mjpage__block"><span class="mjx-chtml MJXc-display" style="text-align: center;"><span class="mjx-math" aria-label=" \begin{split}
    -15 / 4 &amp;= -15 \cdot 2^{-2} \\
    -15 \gg 2 &amp;= 0b11110001 \gg 2 \\
    &amp;= 0b11111100 \\
    &amp;= -4
    \end{split} "><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mtable" style="vertical-align: -2.291em; padding: 0px 0.167em;"><span class="mjx-table"><span class="mjx-mtr" style="height: 1.332em;"><span class="mjx-mtd" style="padding: 0px 0px 0px 0px; text-align: right; width: 3.834em;"><span class="mjx-mrow" style="margin-top: -0.093em;"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">15</span></span><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">/</span></span></span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0px 0px 0px 0px; text-align: left; width: 8.318em;"><span class="mjx-mrow" style="margin-top: -0.093em;"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">15</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.004em; padding-bottom: 0.298em;">⋅</span></span><span class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-texatom" style=""><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span></span></span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 1.3em;"><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">15</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">≫</span></span><span class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: left;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">11110001</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">≫</span></span><span class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 1.3em;"><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: left;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">11111100</span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 1.15em;"><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: left;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">4</span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span></span></span>
    This is not what we expected! Integer division in programming languages such
    as C++ returns the quotient truncated towards zero, so we would expect a
    value of <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="-3"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">3</span></span></span></span></span></span>. The result is close, but incorrect nonetheless.
</p>
<p>
    This means we'll have to be careful not to use this trick on any negative
    numbers. In our difference equation, both the input <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="x[n]"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span> and the output
    <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="y[n]"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span> will generally be positive numbers, so no problem there, but their
    difference can be negative.
    This is a problem. We'll have to come up with a different representation of
    the difference equation that doesn't require us to divide any negative
    numbers:
    <span class="mjpage mjpage__block"><span class="mjx-chtml MJXc-display" style="text-align: center;"><span class="mjx-math" aria-label=" \begin{split}
    y[n] &amp;= y[n-1] + \alpha \left(x[n] - y[n-1]\right) \\
    y[n] &amp;= y[n-1] + \frac{x[n] - y[n-1]}{2^k} \\
    2^k y[n] &amp;= 2^k y[n-1] + x[n] - y[n-1] \\[8pt]
    &amp;\ z[n] \triangleq 2^k y[n] \Leftrightarrow y[n] = 2^{-k} z[n]\\[8pt]
    z[n] &amp;= z[n-1] + x[n] - 2^{-k} z[n-1]
    \end{split} "><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mtable" style="vertical-align: -4.78em; padding: 0px 0.167em;"><span class="mjx-table"><span class="mjx-mtr" style="height: 1.225em;"><span class="mjx-mtd" style="padding: 0px 0px 0px 0px; text-align: right; width: 2.556em;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0px 0px 0px 0px; text-align: left; width: 13.84em;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">α</span></span><span class="mjx-mrow MJXc-space1"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">(</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">)</span></span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 2.882em;"><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: 0.59em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: left;"><span class="mjx-mrow"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mfrac MJXc-space2"><span class="mjx-box MJXc-stacked" style="width: 6.525em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 6.525em; top: -1.59em;"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span><span class="mjx-denominator" style="width: 6.525em; bottom: -0.992em;"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 6.525em;" class="mjx-line"></span></span><span style="height: 2.582em; vertical-align: -0.992em;" class="mjx-vsize"></span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 1.901em;"><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: -0.074em;"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: left;"><span class="mjx-mrow" style="margin-top: -0.074em;"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 2.301em;"><span class="mjx-mtd" style="padding: 0.55em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: -0.074em;"><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.55em 0px 0px 0px; text-align: left;"><span class="mjx-mrow" style="margin-top: -0.074em;"><span class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.291em; padding-bottom: 0.372em;">&nbsp;</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.593em; padding-bottom: 0.298em;">≜</span></span><span class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">⇔</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-texatom" style=""><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 1.751em;"><span class="mjx-mtd" style="padding: 0.55em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: -0.074em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.55em 0px 0px 0px; text-align: left;"><span class="mjx-mrow" style="margin-top: -0.074em;"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-texatom" style=""><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span></span></span>
    We now have to prove that <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="z[n-1]"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span> is greater than or equal to zero.
    We'll prove this using induction:
</p><div style="padding-left: 2em">
    <u>Base case</u>: <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="\quad n-1 = -1"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mspace" style="width: 1em; height: 0px;"></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span>
    <div style="padding: 0.75em">
        The value of <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="z[-1]"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span> is the initial state of the system. We can
        just choose any value, so we'll pick a value that's greater than or
        equal to zero: <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="z[-1] \ge 0"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.446em;">≥</span></span><span class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span>.
    </div>
    <u>Induction step</u>: <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="\quad n"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mspace" style="width: 1em; height: 0px;"></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span></span></span></span></span>
    <div style="padding: 0.75em">
        Given that <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="z[n-1] \ge 0"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.446em;">≥</span></span><span class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span>, we can now use the difference equation
        to prove that <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="z[n]"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span> is also greater than zero:<br>
        <span class="mjpage mjpage__block"><span class="mjx-chtml MJXc-display" style="text-align: center;"><span class="mjx-math" aria-label=" z[n] = z[n-1] + x[n] - 2^{-k} z[n-1] "><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-texatom" style=""><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span>
        We know that the input <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="x[n]"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">x</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span> is always zero or positive. <br>
        Since <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="k \gt 1 \Rightarrow 2^{-k} \lt 1"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">&gt;</span></span><span class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">⇒</span></span><span class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-texatom" style=""><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">&lt;</span></span><span class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span>, and since <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="z[n-1]"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span> is
        zero or positive as well, we know that <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="z[n-1] \ge 2^{-k} z[n-1]
        \Rightarrow z[n-1] - 2^{-k} z[n-1] \ge 0"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.446em;">≥</span></span><span class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-texatom" style=""><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.225em; padding-bottom: 0.372em;">⇒</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-texatom" style=""><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.446em;">≥</span></span><span class="mjx-mn MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">0</span></span></span></span></span></span>.<br>
        Therefore, the entire right-hand side is always positive or zero,
        because it is a sum of two numbers that are themselves greater than
        or equal to zero. <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="\quad\Box"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mspace" style="width: 1em; height: 0px;"></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.446em; padding-bottom: 0.298em;">□</span></span></span></span></span></span>
    </div>
</div>
<p></p>
<h4><a name="rounding" href="#rounding">Rounding</a></h4>
<p>
    A final improvement we can make to our division algorithm is to round the
    result to the nearest integer, instead of truncating it towards zero.<br>
    Consider the rounded result of the division <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="a/b"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span><span class="mjx-texatom"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">/</span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span></span></span></span></span>. We can then express it
    as a flooring of the result plus one half:
    <span class="mjpage mjpage__block"><span class="mjx-chtml MJXc-display" style="text-align: center;"><span class="mjx-math" aria-label=" \begin{split}
    \left\lfloor \frac{a}{b} \right\rceil &amp;=
    \left\lfloor \frac{a}{b} + \frac{1}{2} \right\rfloor \\
    &amp;= \left\lfloor \frac{a + \frac{b}{2}}{b} \right\rfloor \\
    \end{split} "><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mtable" style="vertical-align: -2.883em; padding: 0px 0.167em;"><span class="mjx-table"><span class="mjx-mtr" style="height: 2.599em;"><span class="mjx-mtd" style="padding: 0px 0px 0px 0px; text-align: right; width: 2.135em;"><span class="mjx-mrow"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.256em; padding-bottom: 1.256em;">⌊</span></span><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 0.729em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 0.729em; top: -1.143em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span></span><span class="mjx-denominator" style="width: 0.729em; bottom: -0.795em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 0.729em;" class="mjx-line"></span></span><span style="height: 1.938em; vertical-align: -0.795em;" class="mjx-vsize"></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.256em; padding-bottom: 1.256em;">⌉</span></span></span><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0px 0px 0px 0px; text-align: left; width: 5.631em;"><span class="mjx-mrow"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mrow MJXc-space3"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.256em; padding-bottom: 1.256em;">⌊</span></span><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 0.729em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 0.729em; top: -1.143em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span></span><span class="mjx-denominator" style="width: 0.729em; bottom: -0.795em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 0.729em;" class="mjx-line"></span></span><span style="height: 1.938em; vertical-align: -0.795em;" class="mjx-vsize"></span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mfrac MJXc-space2"><span class="mjx-box MJXc-stacked" style="width: 0.7em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 0.7em; top: -1.368em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span><span class="mjx-denominator" style="width: 0.7em; bottom: -0.756em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 0.7em;" class="mjx-line"></span></span><span style="height: 2.124em; vertical-align: -0.756em;" class="mjx-vsize"></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.256em; padding-bottom: 1.256em;">⌋</span></span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 3.667em;"><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: 1.009em;"><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: left;"><span class="mjx-mrow"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mrow MJXc-space3"><span class="mjx-mo" style="vertical-align: -0.84em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.372em; padding-bottom: 0.298em;">⎢</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.372em; margin-bottom: -0.101em; margin-top: 0px;">⎢
⎢
⎢</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.961em; padding-bottom: 0.888em;">⎣</span></span></span><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 2.686em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 2.686em; top: -2.009em;"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mfrac MJXc-space2"><span class="mjx-box MJXc-stacked" style="width: 0.495em; padding: 0px 0.12em;"><span class="mjx-numerator" style="font-size: 70.7%; width: 0.7em; top: -1.411em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span></span><span class="mjx-denominator" style="font-size: 70.7%; width: 0.7em; bottom: -0.665em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 0.495em;" class="mjx-line"></span></span><span style="height: 1.468em; vertical-align: -0.47em;" class="mjx-vsize"></span></span></span></span><span class="mjx-denominator" style="width: 2.686em; bottom: -0.795em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 2.686em;" class="mjx-line"></span></span><span style="height: 2.804em; vertical-align: -0.795em;" class="mjx-vsize"></span></span><span class="mjx-mo" style="vertical-align: -0.84em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.372em; padding-bottom: 0.298em;">⎥</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.372em; margin-bottom: -0.101em; margin-top: 0px;">⎥
⎥
⎥</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.961em; padding-bottom: 0.888em;">⎦</span></span></span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span></span></span>
    When <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="b"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">b</span></span></span></span></span></span> is a power of two, this is equivalent to:
    <span class="mjpage mjpage__block"><span class="mjx-chtml MJXc-display" style="text-align: center;"><span class="mjx-math" aria-label=" \begin{split}
    \left\lfloor \frac{a}{2^k} \right\rceil &amp;=
    \left\lfloor \frac{a}{2^k} + \frac{1}{2} \right\rfloor \\
    &amp;= \left\lfloor \frac{a + \frac{2^k}{2}}{2^k} \right\rfloor \\
    &amp;= \left\lfloor \frac{a + 2^{k-1}}{2^k} \right\rfloor \\
    &amp;= \left(a + 1 \ll \left(k-1\right)\right) \gg k \\
    \end{split} "><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mtable" style="vertical-align: -5.423em; padding: 0px 0.167em;"><span class="mjx-table"><span class="mjx-mtr" style="height: 2.617em;"><span class="mjx-mtd" style="padding: 0px 0px 0px 0px; text-align: right; width: 2.51em;"><span class="mjx-mrow"><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.256em; padding-bottom: 1.256em;">⌊</span></span><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 1.104em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 1.104em; top: -1.143em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span></span><span class="mjx-denominator" style="width: 1.104em; bottom: -0.992em;"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 1.104em;" class="mjx-line"></span></span><span style="height: 2.134em; vertical-align: -0.992em;" class="mjx-vsize"></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.256em; padding-bottom: 1.256em;">⌉</span></span></span><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0px 0px 0px 0px; text-align: left; width: 11.017em;"><span class="mjx-mrow"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mrow MJXc-space3"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.256em; padding-bottom: 1.256em;">⌊</span></span><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 1.104em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 1.104em; top: -1.143em;"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span></span><span class="mjx-denominator" style="width: 1.104em; bottom: -0.992em;"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 1.104em;" class="mjx-line"></span></span><span style="height: 2.134em; vertical-align: -0.992em;" class="mjx-vsize"></span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mfrac MJXc-space2"><span class="mjx-box MJXc-stacked" style="width: 0.7em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 0.7em; top: -1.368em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span><span class="mjx-denominator" style="width: 0.7em; bottom: -0.756em;"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 0.7em;" class="mjx-line"></span></span><span style="height: 2.124em; vertical-align: -0.756em;" class="mjx-vsize"></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size3-R" style="padding-top: 1.256em; padding-bottom: 1.256em;">⌋</span></span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 4.155em;"><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: 1.177em;"><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: left;"><span class="mjx-mrow"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mrow MJXc-space3"><span class="mjx-mo" style="vertical-align: -1.008em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.372em; padding-bottom: 0.298em;">⎢</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.485em; margin-bottom: -0.101em; margin-top: 0px;">⎢
⎢
⎢</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.961em; padding-bottom: 0.888em;">⎣</span></span></span><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 3.023em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 3.023em; top: -2.177em;"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mfrac MJXc-space2"><span class="mjx-box MJXc-stacked" style="width: 0.831em; padding: 0px 0.12em;"><span class="mjx-numerator" style="font-size: 70.7%; width: 1.176em; top: -1.65em;"><span class="mjx-msubsup" style=""><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 83.3%; vertical-align: 0.443em; padding-left: 0px; padding-right: 0.06em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span><span class="mjx-denominator" style="font-size: 70.7%; width: 1.176em; bottom: -0.665em;"><span class="mjx-mn" style=""><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 0.831em;" class="mjx-line"></span></span><span style="height: 1.637em; vertical-align: -0.47em;" class="mjx-vsize"></span></span></span></span><span class="mjx-denominator" style="width: 3.023em; bottom: -0.992em;"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 3.023em;" class="mjx-line"></span></span><span style="height: 3.169em; vertical-align: -0.992em;" class="mjx-vsize"></span></span><span class="mjx-mo" style="vertical-align: -1.008em;"><span class="mjx-delim-v"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.372em; padding-bottom: 0.298em;">⎥</span><span class="mjx-char MJXc-TeX-size4-R" style="line-height: 0.485em; margin-bottom: -0.101em; margin-top: 0px;">⎥
⎥
⎥</span><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 0.961em; padding-bottom: 0.888em;">⎦</span></span></span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 3.349em;"><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: 0.775em;"><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: left;"><span class="mjx-mrow"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mrow MJXc-space3"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 1.551em; padding-bottom: 1.551em;">⌊</span></span><span class="mjx-mfrac"><span class="mjx-box MJXc-stacked" style="width: 3.759em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 3.759em; top: -1.603em;"><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-texatom" style=""><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span><span class="mjx-denominator" style="width: 3.759em; bottom: -0.992em;"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-mi" style=""><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span><span style="border-bottom: 1.3px solid; top: -0.296em; width: 3.759em;" class="mjx-line"></span></span><span style="height: 2.594em; vertical-align: -0.992em;" class="mjx-vsize"></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-size4-R" style="padding-top: 1.551em; padding-bottom: 1.551em;">⌋</span></span></span><span class="mjx-strut"></span></span></span></span><span class="mjx-mtr" style="height: 1.225em;"><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: right;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-strut"></span></span></span><span class="mjx-mtd" style="padding: 0.15em 0px 0px 0px; text-align: left;"><span class="mjx-mrow" style="margin-top: -0.2em;"><span class="mjx-mi"></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.077em; padding-bottom: 0.298em;">=</span></span><span class="mjx-mrow MJXc-space3"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">(</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">a</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">+</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">≪</span></span><span class="mjx-mrow MJXc-space3"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">(</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">)</span></span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">)</span></span></span><span class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">≫</span></span><span class="mjx-mi MJXc-space3"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span></span></span>
</p>

<h3><a name="implementation-in-c" href="#implementation-in-c">Implementation in C++</a></h3>

<p>
    We now have everything in place to write a basic implementation of the EMA in C++:
</p>

<div class="codesnippet"><style>.pygments122 .hll { background-color: #ffffcc }
.pygments122  { background: #f8f8f8; }
.pygments122 .c { color: #408080; font-style: italic } /* Comment */
.pygments122 .err { border: 1px solid #FF0000 } /* Error */
.pygments122 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments122 .o { color: #666666 } /* Operator */
.pygments122 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments122 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments122 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments122 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments122 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments122 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments122 .gd { color: #A00000 } /* Generic.Deleted */
.pygments122 .ge { font-style: italic } /* Generic.Emph */
.pygments122 .gr { color: #FF0000 } /* Generic.Error */
.pygments122 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments122 .gi { color: #00A000 } /* Generic.Inserted */
.pygments122 .go { color: #888888 } /* Generic.Output */
.pygments122 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments122 .gs { font-weight: bold } /* Generic.Strong */
.pygments122 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments122 .gt { color: #0044DD } /* Generic.Traceback */
.pygments122 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments122 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments122 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments122 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments122 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments122 .kt { color: #B00040 } /* Keyword.Type */
.pygments122 .m { color: #666666 } /* Literal.Number */
.pygments122 .s { color: #BA2121 } /* Literal.String */
.pygments122 .na { color: #7D9029 } /* Name.Attribute */
.pygments122 .nb { color: #008000 } /* Name.Builtin */
.pygments122 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments122 .no { color: #880000 } /* Name.Constant */
.pygments122 .nd { color: #AA22FF } /* Name.Decorator */
.pygments122 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments122 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments122 .nf { color: #0000FF } /* Name.Function */
.pygments122 .nl { color: #A0A000 } /* Name.Label */
.pygments122 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments122 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments122 .nv { color: #19177C } /* Name.Variable */
.pygments122 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments122 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments122 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments122 .mf { color: #666666 } /* Literal.Number.Float */
.pygments122 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments122 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments122 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments122 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments122 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments122 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments122 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments122 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments122 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments122 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments122 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments122 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments122 .sx { color: #008000 } /* Literal.String.Other */
.pygments122 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments122 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments122 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments122 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments122 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments122 .vc { color: #19177C } /* Name.Variable.Class */
.pygments122 .vg { color: #19177C } /* Name.Variable.Global */
.pygments122 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments122 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments122 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments122 pre.snippet122 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/EMA-basic.hpp" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments122"><pre class="lineNumbers snippet122"><code><span></span><span class="cp">#pragma once</span></code>
<code><span class="cp">#include</span> <span class="cpf">&lt;cstdint&gt;     // uint8_t, uint16_t</span><span class="cp"></span></code>
<code><span class="cp">#include</span> <span class="cpf">&lt;type_traits&gt; // std::is_unsigned</span><span class="cp"></span></code>
<code></code>
<code><span class="c1">/// The first Exponential Moving Average implementation for unsigned integers.</span></code>
<code><span class="c1">///</span></code>
<code><span class="c1">/// @note   An improved implementation is presented further down the page.</span></code>
<code><span class="k">template</span> <span class="o">&lt;</span><span class="kt">uint8_t</span> <span class="n">K</span><span class="p">,</span> <span class="k">class</span> <span class="nc">uint_t</span> <span class="o">=</span> <span class="kt">uint16_t</span><span class="o">&gt;</span></code>
<code><span class="k">class</span> <span class="nc">EMA</span> <span class="p">{</span></code>
<code>  <span class="k">public</span><span class="o">:</span></code>
<code>    <span class="c1">/// Update the filter with the given input and return the filtered output.</span></code>
<code>    <span class="n">uint_t</span> <span class="k">operator</span><span class="p">()(</span><span class="n">uint_t</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span></code>
<code>        <span class="n">state</span> <span class="o">+=</span> <span class="n">input</span><span class="p">;</span></code>
<code>        <span class="n">uint_t</span> <span class="n">output</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span> <span class="o">+</span> <span class="n">half</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">K</span><span class="p">;</span></code>
<code>        <span class="n">state</span> <span class="o">-=</span> <span class="n">output</span><span class="p">;</span></code>
<code>        <span class="k">return</span> <span class="n">output</span><span class="p">;</span></code>
<code>    <span class="p">}</span></code>
<code></code>
<code>    <span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_unsigned</span><span class="o">&lt;</span><span class="n">uint_t</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span></code>
<code>                  <span class="s">"The `uint_t` type should be an unsigned integer, "</span></code>
<code>                  <span class="s">"otherwise, the division using bit shifts is invalid."</span><span class="p">);</span></code>
<code></code>
<code>    <span class="c1">/// Fixed point representation of one half, used for rounding.</span></code>
<code>    <span class="k">constexpr</span> <span class="k">static</span> <span class="n">uint_t</span> <span class="n">half</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span></code>
<code></code>
<code>  <span class="k">private</span><span class="o">:</span></code>
<code>    <span class="n">uint_t</span> <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></code>
<code><span class="p">};</span></code></pre></div>
</div>

<p>
    Note how we save <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="z[n] - 2^{-k} z[n]"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-texatom" style=""><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span> as the state, instead of just
    <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="z[n]"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span>.
    Otherwise, we would have to calculate <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="2^{-k} z[n]"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-texatom" style=""><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span> twice (once to
    calculate <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="y[n]"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.519em; padding-right: 0.006em;">y</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span>, and once on the next iteration to calculate
    <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="2^{-k} z[n-1]"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-texatom" style=""><span class="mjx-mrow"><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">k</span></span></span></span></span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em; padding-right: 0.003em;">z</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">[</span></span><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.225em; padding-bottom: 0.298em;">n</span></span><span class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.446em; padding-bottom: 0.593em;">]</span></span></span></span></span></span>), and that would be unnecessary.
</p>

<h3><a name="signed-rounding-division" href="#signed-rounding-division">Signed Rounding Division</a></h3>

<p>
    It's possible to implement a signed division using bit shifts as well. The
    only difference is that we have to subtract 1 from the dividend if it's
    negative.
</p>
<p>
    On ARM and x86 platforms, the absolute performance difference between the
    signed and unsigned version is not too big, it requires just a few more
    instructions.
    However, on some other architectures, like the AVR architecture used by some
    Arduino microcontrollers, the division is by far the most expensive step of
    the EMA algorithm, so a slower signed division might have a significant
    impact on the overall performance. In theory, it should only take a couple
    instructions to conditionally subtract 1, based on the sign of the dividend,
    but this sometimes causes the compiler to refactor the entire division,
    resulting in a much slower algorithm.
</p>
<p>
    I provided two implementations of the signed division. Notice how on x86 and
    ARM the second one is faster, while on AVR, the first one is faster.
    The unsigned division is included for reference.
</p>
<p>
    The code was compiled using the <code>-O2</code> optimization level.
</p>

<h4><a name="implementation-of-signed-and-unsigned-division-by-a-multiple-of-two" href="#implementation-of-signed-and-unsigned-division-by-a-multiple-of-two">Implementation of Signed and Unsigned Division by a Multiple of Two</a></h4>
<div class="codesnippet"><style>.pygments163 .hll { background-color: #ffffcc }
.pygments163  { background: #f8f8f8; }
.pygments163 .c { color: #408080; font-style: italic } /* Comment */
.pygments163 .err { border: 1px solid #FF0000 } /* Error */
.pygments163 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments163 .o { color: #666666 } /* Operator */
.pygments163 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments163 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments163 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments163 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments163 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments163 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments163 .gd { color: #A00000 } /* Generic.Deleted */
.pygments163 .ge { font-style: italic } /* Generic.Emph */
.pygments163 .gr { color: #FF0000 } /* Generic.Error */
.pygments163 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments163 .gi { color: #00A000 } /* Generic.Inserted */
.pygments163 .go { color: #888888 } /* Generic.Output */
.pygments163 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments163 .gs { font-weight: bold } /* Generic.Strong */
.pygments163 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments163 .gt { color: #0044DD } /* Generic.Traceback */
.pygments163 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments163 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments163 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments163 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments163 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments163 .kt { color: #B00040 } /* Keyword.Type */
.pygments163 .m { color: #666666 } /* Literal.Number */
.pygments163 .s { color: #BA2121 } /* Literal.String */
.pygments163 .na { color: #7D9029 } /* Name.Attribute */
.pygments163 .nb { color: #008000 } /* Name.Builtin */
.pygments163 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments163 .no { color: #880000 } /* Name.Constant */
.pygments163 .nd { color: #AA22FF } /* Name.Decorator */
.pygments163 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments163 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments163 .nf { color: #0000FF } /* Name.Function */
.pygments163 .nl { color: #A0A000 } /* Name.Label */
.pygments163 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments163 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments163 .nv { color: #19177C } /* Name.Variable */
.pygments163 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments163 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments163 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments163 .mf { color: #666666 } /* Literal.Number.Float */
.pygments163 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments163 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments163 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments163 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments163 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments163 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments163 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments163 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments163 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments163 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments163 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments163 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments163 .sx { color: #008000 } /* Literal.String.Other */
.pygments163 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments163 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments163 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments163 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments163 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments163 .vc { color: #19177C } /* Name.Variable.Class */
.pygments163 .vg { color: #19177C } /* Name.Variable.Global */
.pygments163 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments163 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments163 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments163 pre.snippet163 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/Rounding-Division.cpp" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments163"><pre class="lineNumbers snippet163"><code><span></span><span class="k">constexpr</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">K</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span></code>
<code></code>
<code><span class="kt">signed</span> <span class="kt">int</span> <span class="nf">div_s1</span><span class="p">(</span><span class="kt">signed</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span></code>
<code>    <span class="kt">int</span> <span class="n">round</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span></code>
<code>    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span></code>
<code>        <span class="n">round</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span></code>
<code>    <span class="k">return</span> <span class="n">round</span> <span class="o">&gt;&gt;</span> <span class="n">K</span><span class="p">;</span></code>
<code><span class="p">}</span></code>
<code></code>
<code><span class="kt">signed</span> <span class="kt">int</span> <span class="nf">div_s2</span><span class="p">(</span><span class="kt">signed</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span></code>
<code>    <span class="kt">int</span> <span class="n">neg</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span></code>
<code>    <span class="k">return</span> <span class="p">(</span><span class="n">val</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">neg</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">K</span><span class="p">;</span></code>
<code><span class="p">}</span></code>
<code></code>
<code><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">div_u</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span></code>
<code>    <span class="k">return</span> <span class="p">(</span><span class="n">val</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">&gt;&gt;</span> <span class="n">K</span><span class="p">;</span></code>
<code><span class="p">}</span></code></pre></div>
</div>
<h4 class="snippet-name"><a name="assembly-generated-on-x86-64-gcc-9-2" href="#assembly-generated-on-x86-64-gcc-9-2">Assembly Generated on x86_64 (GCC 9.2)</a></h4>
<div class="codesnippet"><style>.pygments166 .hll { background-color: #ffffcc }
.pygments166  { background: #f8f8f8; }
.pygments166 .c { color: #408080; font-style: italic } /* Comment */
.pygments166 .err { border: 1px solid #FF0000 } /* Error */
.pygments166 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments166 .o { color: #666666 } /* Operator */
.pygments166 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments166 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments166 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments166 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments166 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments166 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments166 .gd { color: #A00000 } /* Generic.Deleted */
.pygments166 .ge { font-style: italic } /* Generic.Emph */
.pygments166 .gr { color: #FF0000 } /* Generic.Error */
.pygments166 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments166 .gi { color: #00A000 } /* Generic.Inserted */
.pygments166 .go { color: #888888 } /* Generic.Output */
.pygments166 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments166 .gs { font-weight: bold } /* Generic.Strong */
.pygments166 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments166 .gt { color: #0044DD } /* Generic.Traceback */
.pygments166 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments166 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments166 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments166 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments166 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments166 .kt { color: #B00040 } /* Keyword.Type */
.pygments166 .m { color: #666666 } /* Literal.Number */
.pygments166 .s { color: #BA2121 } /* Literal.String */
.pygments166 .na { color: #7D9029 } /* Name.Attribute */
.pygments166 .nb { color: #008000 } /* Name.Builtin */
.pygments166 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments166 .no { color: #880000 } /* Name.Constant */
.pygments166 .nd { color: #AA22FF } /* Name.Decorator */
.pygments166 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments166 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments166 .nf { color: #0000FF } /* Name.Function */
.pygments166 .nl { color: #A0A000 } /* Name.Label */
.pygments166 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments166 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments166 .nv { color: #19177C } /* Name.Variable */
.pygments166 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments166 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments166 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments166 .mf { color: #666666 } /* Literal.Number.Float */
.pygments166 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments166 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments166 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments166 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments166 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments166 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments166 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments166 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments166 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments166 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments166 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments166 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments166 .sx { color: #008000 } /* Literal.String.Other */
.pygments166 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments166 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments166 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments166 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments166 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments166 .vc { color: #19177C } /* Name.Variable.Class */
.pygments166 .vg { color: #19177C } /* Name.Variable.Global */
.pygments166 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments166 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments166 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments166 pre.snippet166 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/Rounding-Division-x86_64.S" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments166"><pre class="lineNumbers snippet166"><code><span></span><span class="nf">div_s1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="o">:</span></code>
<code>        <span class="n">mov</span>     <span class="n">eax</span><span class="p">,</span> <span class="n">edi</span></code>
<code>        <span class="n">not</span>     <span class="n">eax</span></code>
<code>        <span class="n">shr</span>     <span class="n">eax</span><span class="p">,</span> <span class="m">31</span></code>
<code>        <span class="n">lea</span>     <span class="n">eax</span><span class="p">,</span> <span class="p">[</span><span class="n">rax</span><span class="m">+3</span><span class="o">+</span><span class="n">rdi</span><span class="p">]</span></code>
<code>        <span class="n">sar</span>     <span class="n">eax</span><span class="p">,</span> <span class="m">3</span></code>
<code>        <span class="n">ret</span></code>
<code></code>
<code><span class="nf">div_s2</span><span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="o">:</span></code>
<code>        <span class="n">lea</span>     <span class="n">eax</span><span class="p">,</span> <span class="p">[</span><span class="n">rdi</span><span class="m">+4</span><span class="p">]</span></code>
<code>        <span class="n">shr</span>     <span class="n">edi</span><span class="p">,</span> <span class="m">31</span></code>
<code>        <span class="n">sub</span>     <span class="n">eax</span><span class="p">,</span> <span class="n">edi</span></code>
<code>        <span class="n">sar</span>     <span class="n">eax</span><span class="p">,</span> <span class="m">3</span></code>
<code>        <span class="n">ret</span></code>
<code></code>
<code><span class="nf">div_u</span><span class="p">(</span><span class="n">unsigned</span> <span class="n">int</span><span class="p">)</span><span class="o">:</span></code>
<code>        <span class="n">lea</span>     <span class="n">eax</span><span class="p">,</span> <span class="p">[</span><span class="n">rdi</span><span class="m">+4</span><span class="p">]</span></code>
<code>        <span class="n">shr</span>     <span class="n">eax</span><span class="p">,</span> <span class="m">3</span></code>
<code>        <span class="n">ret</span></code></pre></div>
</div>
<h4 class="snippet-name"><a name="assembly-generated-on-arm-64-gcc-8-2" href="#assembly-generated-on-arm-64-gcc-8-2">Assembly Generated on ARM 64 (GCC 8.2)</a></h4>
<div class="codesnippet"><style>.pygments170 .hll { background-color: #ffffcc }
.pygments170  { background: #f8f8f8; }
.pygments170 .c { color: #408080; font-style: italic } /* Comment */
.pygments170 .err { border: 1px solid #FF0000 } /* Error */
.pygments170 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments170 .o { color: #666666 } /* Operator */
.pygments170 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments170 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments170 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments170 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments170 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments170 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments170 .gd { color: #A00000 } /* Generic.Deleted */
.pygments170 .ge { font-style: italic } /* Generic.Emph */
.pygments170 .gr { color: #FF0000 } /* Generic.Error */
.pygments170 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments170 .gi { color: #00A000 } /* Generic.Inserted */
.pygments170 .go { color: #888888 } /* Generic.Output */
.pygments170 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments170 .gs { font-weight: bold } /* Generic.Strong */
.pygments170 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments170 .gt { color: #0044DD } /* Generic.Traceback */
.pygments170 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments170 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments170 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments170 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments170 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments170 .kt { color: #B00040 } /* Keyword.Type */
.pygments170 .m { color: #666666 } /* Literal.Number */
.pygments170 .s { color: #BA2121 } /* Literal.String */
.pygments170 .na { color: #7D9029 } /* Name.Attribute */
.pygments170 .nb { color: #008000 } /* Name.Builtin */
.pygments170 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments170 .no { color: #880000 } /* Name.Constant */
.pygments170 .nd { color: #AA22FF } /* Name.Decorator */
.pygments170 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments170 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments170 .nf { color: #0000FF } /* Name.Function */
.pygments170 .nl { color: #A0A000 } /* Name.Label */
.pygments170 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments170 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments170 .nv { color: #19177C } /* Name.Variable */
.pygments170 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments170 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments170 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments170 .mf { color: #666666 } /* Literal.Number.Float */
.pygments170 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments170 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments170 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments170 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments170 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments170 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments170 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments170 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments170 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments170 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments170 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments170 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments170 .sx { color: #008000 } /* Literal.String.Other */
.pygments170 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments170 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments170 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments170 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments170 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments170 .vc { color: #19177C } /* Name.Variable.Class */
.pygments170 .vg { color: #19177C } /* Name.Variable.Global */
.pygments170 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments170 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments170 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments170 pre.snippet170 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/Rounding-Division-ARM.S" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments170"><pre class="lineNumbers snippet170"><code><span></span><span class="nf">div_s1</span><span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="o">:</span></code>
<code>        <span class="n">mvn</span>     <span class="n">w1</span><span class="p">,</span> <span class="n">w0</span></code>
<code>        <span class="n">add</span>     <span class="n">w0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">lsr</span> <span class="m">31</span></code>
<code>        <span class="n">add</span>     <span class="n">w0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="m">3</span></code>
<code>        <span class="n">asr</span>     <span class="n">w0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="m">3</span></code>
<code>        <span class="n">ret</span></code>
<code></code>
<code><span class="nf">div_s2</span><span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="o">:</span></code>
<code>        <span class="n">add</span>     <span class="n">w1</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="m">4</span></code>
<code>        <span class="n">sub</span>     <span class="n">w0</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">lsr</span> <span class="m">31</span></code>
<code>        <span class="n">asr</span>     <span class="n">w0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="m">3</span></code>
<code>        <span class="n">ret</span></code>
<code></code>
<code><span class="nf">div_u</span><span class="p">(</span><span class="n">unsigned</span> <span class="n">int</span><span class="p">)</span><span class="o">:</span></code>
<code>        <span class="n">add</span>     <span class="n">w0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="m">4</span></code>
<code>        <span class="n">lsr</span>     <span class="n">w0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="m">3</span></code>
<code>        <span class="n">ret</span></code></pre></div>
</div>
<h4 class="snippet-name"><a name="assembly-generated-on-avr-gcc-5-3" href="#assembly-generated-on-avr-gcc-5-3">Assembly Generated on AVR (GCC 5.3)</a></h4>
<div class="codesnippet"><style>.pygments174 .hll { background-color: #ffffcc }
.pygments174  { background: #f8f8f8; }
.pygments174 .c { color: #408080; font-style: italic } /* Comment */
.pygments174 .err { border: 1px solid #FF0000 } /* Error */
.pygments174 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments174 .o { color: #666666 } /* Operator */
.pygments174 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments174 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments174 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments174 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments174 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments174 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments174 .gd { color: #A00000 } /* Generic.Deleted */
.pygments174 .ge { font-style: italic } /* Generic.Emph */
.pygments174 .gr { color: #FF0000 } /* Generic.Error */
.pygments174 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments174 .gi { color: #00A000 } /* Generic.Inserted */
.pygments174 .go { color: #888888 } /* Generic.Output */
.pygments174 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments174 .gs { font-weight: bold } /* Generic.Strong */
.pygments174 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments174 .gt { color: #0044DD } /* Generic.Traceback */
.pygments174 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments174 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments174 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments174 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments174 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments174 .kt { color: #B00040 } /* Keyword.Type */
.pygments174 .m { color: #666666 } /* Literal.Number */
.pygments174 .s { color: #BA2121 } /* Literal.String */
.pygments174 .na { color: #7D9029 } /* Name.Attribute */
.pygments174 .nb { color: #008000 } /* Name.Builtin */
.pygments174 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments174 .no { color: #880000 } /* Name.Constant */
.pygments174 .nd { color: #AA22FF } /* Name.Decorator */
.pygments174 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments174 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments174 .nf { color: #0000FF } /* Name.Function */
.pygments174 .nl { color: #A0A000 } /* Name.Label */
.pygments174 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments174 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments174 .nv { color: #19177C } /* Name.Variable */
.pygments174 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments174 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments174 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments174 .mf { color: #666666 } /* Literal.Number.Float */
.pygments174 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments174 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments174 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments174 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments174 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments174 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments174 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments174 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments174 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments174 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments174 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments174 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments174 .sx { color: #008000 } /* Literal.String.Other */
.pygments174 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments174 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments174 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments174 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments174 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments174 .vc { color: #19177C } /* Name.Variable.Class */
.pygments174 .vg { color: #19177C } /* Name.Variable.Global */
.pygments174 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments174 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments174 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments174 pre.snippet174 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/Rounding-Division-AVR.S" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments174"><pre class="lineNumbers snippet174"><code><span></span><span class="nf">div_s1</span><span class="p">(</span><span class="no">int</span><span class="p">):</span></code>
<code>        <span class="nf">sbrc</span> <span class="no">r25</span><span class="p">,</span><span class="mi">7</span>  <span class="c1"># Skip if Bit in Register is Cleared: val &gt;= 0</span></code>
<code>        <span class="nf">rjmp</span> <span class="no">.L2</span></code>
<code>                    <span class="c1"># val &gt;= 0</span></code>
<code>        <span class="nf">adiw</span> <span class="no">r24</span><span class="p">,</span><span class="mi">4</span>  <span class="c1"># Add Immediate to Word: val + (1 &lt;&lt; (K - 1)) = val + 4</span></code>
<code>        <span class="nf">asr</span> <span class="no">r25</span>     <span class="c1"># Arithmetic Shift Right: shift high byte (preserve sign)</span></code>
<code>        <span class="nf">ror</span> <span class="no">r24</span>     <span class="c1"># Rotate Right through Carry: shift low byte</span></code>
<code>        <span class="nf">asr</span> <span class="no">r25</span>     <span class="c1"># Two more times</span></code>
<code>        <span class="nf">ror</span> <span class="no">r24</span></code>
<code>        <span class="nf">asr</span> <span class="no">r25</span></code>
<code>        <span class="nf">ror</span> <span class="no">r24</span></code>
<code>        <span class="nf">ret</span></code>
<code><span class="nl">.L2:</span>                </code>
<code>                    <span class="c1"># val &lt; 0</span></code>
<code>        <span class="nf">adiw</span> <span class="no">r24</span><span class="p">,</span><span class="mi">3</span>  <span class="c1"># Add Immediate to Word: val + (1 &lt;&lt; (K - 1)) - 1 = val + 3</span></code>
<code>        <span class="nf">asr</span> <span class="no">r25</span>     <span class="c1"># Arithmetic Shift Right: shift high byte (preserve sign)</span></code>
<code>        <span class="nf">ror</span> <span class="no">r24</span>     <span class="c1"># Rotate Right through Carry: shift low byte</span></code>
<code>        <span class="nf">asr</span> <span class="no">r25</span>     <span class="c1"># Two more times</span></code>
<code>        <span class="nf">ror</span> <span class="no">r24</span></code>
<code>        <span class="nf">asr</span> <span class="no">r25</span></code>
<code>        <span class="nf">ror</span> <span class="no">r24</span></code>
<code>        <span class="nf">ret</span></code>
<code></code>
<code><span class="nf">div_s2</span><span class="p">(</span><span class="no">int</span><span class="p">):</span></code>
<code>        <span class="nf">movw</span> <span class="no">r18</span><span class="p">,</span><span class="no">r24</span></code>
<code>        <span class="nf">subi</span> <span class="no">r18</span><span class="p">,-</span><span class="mi">4</span>   <span class="c1"># Subtract immediate: val + (1 &lt;&lt; (K - 1)) = val + 4</span></code>
<code>        <span class="nf">sbci</span> <span class="no">r19</span><span class="p">,-</span><span class="mi">1</span>   <span class="c1"># Subtract Immediate with Carry: (low byte)</span></code>
<code>        <span class="nf">mov</span> <span class="no">r24</span><span class="p">,</span><span class="no">r25</span></code>
<code>        <span class="nf">rol</span> <span class="no">r24</span>       <span class="c1"># Rotate Left through Carry: C flag is now sign bit</span></code>
<code>        <span class="nf">clr</span> <span class="no">r24</span>       <span class="c1"># Clear Register</span></code>
<code>        <span class="nf">rol</span> <span class="no">r24</span>       <span class="c1"># Rotate Left through Carry: original sign bit is now lsb</span></code>
<code>        <span class="nf">movw</span> <span class="no">r20</span><span class="p">,</span><span class="no">r18</span></code>
<code>        <span class="nf">sub</span> <span class="no">r20</span><span class="p">,</span><span class="no">r24</span>   <span class="c1"># Subtract without Carry: val + 4 - neg</span></code>
<code>        <span class="nf">sbc</span> <span class="no">r21</span><span class="p">,</span><span class="no">__zero_reg__</span>  <span class="c1"># Subtract with Carry: (low byte)</span></code>
<code>        <span class="nf">movw</span> <span class="no">r24</span><span class="p">,</span><span class="no">r20</span></code>
<code>        <span class="nf">asr</span> <span class="no">r25</span>       <span class="c1"># Arithmetic Shift Right: shift high byte (preserve sign)</span></code>
<code>        <span class="nf">ror</span> <span class="no">r24</span>       <span class="c1"># Rotate Right through Carry: shift low byte</span></code>
<code>        <span class="nf">asr</span> <span class="no">r25</span>       <span class="c1"># Two more times</span></code>
<code>        <span class="nf">ror</span> <span class="no">r24</span></code>
<code>        <span class="nf">asr</span> <span class="no">r25</span></code>
<code>        <span class="nf">ror</span> <span class="no">r24</span></code>
<code>        <span class="nf">ret</span></code>
<code></code>
<code><span class="nf">div_u</span><span class="p">(</span><span class="no">unsigned</span> <span class="no">int</span><span class="p">):</span></code>
<code>        <span class="nf">adiw</span> <span class="no">r24</span><span class="p">,</span><span class="mi">4</span>  <span class="c1"># Add Immediate to Word: val + (1 &lt;&lt; (K - 1)) = val + 4</span></code>
<code>        <span class="nf">lsr</span> <span class="no">r25</span>     <span class="c1"># Logical Shift Right: shift high byte (no sign extension)</span></code>
<code>        <span class="nf">ror</span> <span class="no">r24</span>     <span class="c1"># Rotate Right through Carry: shift low byte</span></code>
<code>        <span class="nf">lsr</span> <span class="no">r25</span>     <span class="c1"># Two more times</span></code>
<code>        <span class="nf">ror</span> <span class="no">r24</span></code>
<code>        <span class="nf">lsr</span> <span class="no">r25</span></code>
<code>        <span class="nf">ror</span> <span class="no">r24</span></code>
<code>        <span class="nf">ret</span></code></pre></div>
</div>
<p>
    Keep in mind that an <code>int</code> on AVR is only 16 bits wide, whereas
    an <code>int</code> on ARM or x86 is 32 bits wide.<br>
    If you use 32-bit integers on AVR, the result is even more atrocious.
</p>
<p>
    You can experiment with the different implementations yourself on the
    <a href="https://godbolt.org/z/cmQJ7W">Compiler Explorer</a>.
</p>
<p>
    The main takeaway from this section is that signed (rounding) division is more expensive than unsigned division.
</p>

<h4><a name="a-better-alternative-for-signed-division" href="#a-better-alternative-for-signed-division">A better alternative for signed division</a></h4>

<p>
    Since the EMA is a linear filter, adding a constant offset to the input results in the same output, but with the
    same offset added to it. This means that we don't have to worry about negative numbers, we can just add a constant
    offset to the negative inputs, resulting in only positive numbers. At the output of the filter, the offset is simply
    removed again.
</p>
<p>
    This approach turns out to be significantly more efficient than the signed divisions discussed above. It allows us
    to use only unsigned rounding divisions, which are very cheap, and just a single extra subtraction to handle signed
    types. (Yes, just one, it turns out that adding the offset to the input and subtracting it again from the output
    can be combined.)
</p>

<p>
    <small>
        The assumption that the EMA is a linear filter is not really valid anymore, because of the rounding and
        truncation errors introduced by the use of integers in the algorithm. Luckily, the output of the filter
        turns out to be exactly the same, it doesn't matter if you use true signed rounding division or an
        unsigned rounding division with offset.
    </small>
</p>

<h3><a name="improved-c-implementation" href="#improved-c-implementation">Improved C++ implementation</a></h3>

<p>
    The following snippet is an improved version of the previous implementation: it supports both signed and unsigned
    inputs, allows initialization to a specific value, and has a check to prevent overflow.
</p>

<div class="codesnippet"><style>.pygments222 .hll { background-color: #ffffcc }
.pygments222  { background: #f8f8f8; }
.pygments222 .c { color: #408080; font-style: italic } /* Comment */
.pygments222 .err { border: 1px solid #FF0000 } /* Error */
.pygments222 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments222 .o { color: #666666 } /* Operator */
.pygments222 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments222 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments222 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments222 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments222 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments222 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments222 .gd { color: #A00000 } /* Generic.Deleted */
.pygments222 .ge { font-style: italic } /* Generic.Emph */
.pygments222 .gr { color: #FF0000 } /* Generic.Error */
.pygments222 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments222 .gi { color: #00A000 } /* Generic.Inserted */
.pygments222 .go { color: #888888 } /* Generic.Output */
.pygments222 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments222 .gs { font-weight: bold } /* Generic.Strong */
.pygments222 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments222 .gt { color: #0044DD } /* Generic.Traceback */
.pygments222 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments222 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments222 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments222 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments222 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments222 .kt { color: #B00040 } /* Keyword.Type */
.pygments222 .m { color: #666666 } /* Literal.Number */
.pygments222 .s { color: #BA2121 } /* Literal.String */
.pygments222 .na { color: #7D9029 } /* Name.Attribute */
.pygments222 .nb { color: #008000 } /* Name.Builtin */
.pygments222 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments222 .no { color: #880000 } /* Name.Constant */
.pygments222 .nd { color: #AA22FF } /* Name.Decorator */
.pygments222 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments222 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments222 .nf { color: #0000FF } /* Name.Function */
.pygments222 .nl { color: #A0A000 } /* Name.Label */
.pygments222 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments222 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments222 .nv { color: #19177C } /* Name.Variable */
.pygments222 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments222 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments222 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments222 .mf { color: #666666 } /* Literal.Number.Float */
.pygments222 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments222 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments222 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments222 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments222 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments222 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments222 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments222 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments222 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments222 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments222 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments222 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments222 .sx { color: #008000 } /* Literal.String.Other */
.pygments222 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments222 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments222 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments222 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments222 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments222 .vc { color: #19177C } /* Name.Variable.Class */
.pygments222 .vg { color: #19177C } /* Name.Variable.Global */
.pygments222 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments222 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments222 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments222 pre.snippet222 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/EMA.hpp" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments222"><pre class="lineNumbers snippet222"><code><span></span><span class="cp">#pragma once</span></code>
<code><span class="cp">#include</span> <span class="cpf">&lt;type_traits&gt; // std::make_unsigned_t, make_signed_t, is_unsigned</span><span class="cp"></span></code>
<code><span class="cp">#include</span> <span class="cpf">&lt;limits&gt;      // std::numeric_limits</span><span class="cp"></span></code>
<code><span class="cp">#include</span> <span class="cpf">&lt;cstdint&gt;     // uint_fast16_t</span><span class="cp"></span></code>
<code></code>
<code><span class="cm">/**</span></code>
<code><span class="cm"> * @brief   Exponential moving average filter.</span></code>
<code><span class="cm"> * </span></code>
<code><span class="cm"> * Fast integer EMA implementation where the weight factor is a power of two.</span></code>
<code><span class="cm"> * </span></code>
<code><span class="cm"> * Difference equation: @f$ y[n] = \alpha·x[n]+(1-\alpha)·y[n-1] @f$</span></code>
<code><span class="cm"> * where @f$ \alpha = \left(\frac{1}{2}\right)^{K} @f$, @f$ x @f$ is the</span></code>
<code><span class="cm"> * input sequence, and @f$ y @f$ is the output sequence.</span></code>
<code><span class="cm"> *</span></code>
<code><span class="cm"> * [An in-depth explanation of the EMA filter](https://tttapa.github.io/Pages/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential%20Moving%20Average/)</span></code>
<code><span class="cm"> *</span></code>
<code><span class="cm"> * @tparam  K</span></code>
<code><span class="cm"> *          The amount of bits to shift by. This determines the location</span></code>
<code><span class="cm"> *          of the pole in the EMA transfer function, and therefore the</span></code>
<code><span class="cm"> *          cut-off frequency.  </span></code>
<code><span class="cm"> *          The higher this number, the more filtering takes place.  </span></code>
<code><span class="cm"> *          The pole location is @f$ 1 - 2^{-K} @f$.</span></code>
<code><span class="cm"> * @tparam  input_t</span></code>
<code><span class="cm"> *          The integer type to use for the input and output of the filter. </span></code>
<code><span class="cm"> *          Can be signed or unsigned.</span></code>
<code><span class="cm"> * @tparam  state_t</span></code>
<code><span class="cm"> *          The unsigned integer type to use for the internal state of the</span></code>
<code><span class="cm"> *          filter. A fixed-point representation with @f$ K @f$ fractional</span></code>
<code><span class="cm"> *          bits is used, so this type should be at least @f$ M + K @f$ bits</span></code>
<code><span class="cm"> *          wide, where @f$ M @f$ is the maximum number of bits of the input.</span></code>
<code><span class="cm"> *</span></code>
<code><span class="cm"> * Some examples of different combinations of template parameters:</span></code>
<code><span class="cm"> * </span></code>
<code><span class="cm"> * 1. Filtering the result of `analogRead`: analogRead returns an integer</span></code>
<code><span class="cm"> *    between 0 and 1023, which can be represented using 10 bits, so </span></code>
<code><span class="cm"> *    @f$ M = 10 @f$. If `input_t` and `output_t` are both `uint16_t`,</span></code>
<code><span class="cm"> *    the maximum shift factor `K` is @f$ 16 - M = 6 @f$. If `state_t`</span></code>
<code><span class="cm"> *    is increased to `uint32_t`, the maximum shift factor `K` is </span></code>
<code><span class="cm"> *    @f$ 32 - M = 22 @f$.</span></code>
<code><span class="cm"> * 2. Filtering a signed integer between -32768 and 32767: this can be </span></code>
<code><span class="cm"> *    represented using a 16-bit signed integer, so `input_t` is `int16_t`,</span></code>
<code><span class="cm"> *    and @f$ M = 16 @f$. (2¹⁵ = 32768)</span></code>
<code><span class="cm"> *    Let's say the shift factor `K` is 1, then the minimum width of </span></code>
<code><span class="cm"> *    `state_t` should be @f$ M + K = 17 @f$ bits, so `uint32_t` would be </span></code>
<code><span class="cm"> *    a sensible choice.</span></code>
<code><span class="cm"> */</span></code>
<code><span class="k">template</span> <span class="o">&lt;</span><span class="kt">uint8_t</span> <span class="n">K</span><span class="p">,</span></code>
<code>          <span class="k">class</span> <span class="nc">input_t</span> <span class="o">=</span> <span class="kt">uint_fast16_t</span><span class="p">,</span></code>
<code>          <span class="k">class</span> <span class="nc">state_t</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unsigned_t</span><span class="o">&lt;</span><span class="n">input_t</span><span class="o">&gt;&gt;</span></code>
<code><span class="k">class</span> <span class="nc">EMA</span> <span class="p">{</span></code>
<code>  <span class="k">public</span><span class="o">:</span></code>
<code>    <span class="c1">/// Constructor: initialize filter to zero or optional given value.</span></code>
<code>    <span class="n">EMA</span><span class="p">(</span><span class="n">input_t</span> <span class="n">initial</span> <span class="o">=</span> <span class="n">input_t</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span></code>
<code>      <span class="o">:</span> <span class="n">state</span><span class="p">(</span><span class="n">zero</span> <span class="o">+</span> <span class="p">(</span><span class="n">initial</span> <span class="o">&lt;&lt;</span> <span class="n">K</span><span class="p">)</span> <span class="o">-</span> <span class="n">initial</span><span class="p">)</span> <span class="p">{}</span></code>
<code></code>
<code>    <span class="c1">/// Update the filter with the given input and return the filtered output.</span></code>
<code>    <span class="n">input_t</span> <span class="k">operator</span><span class="p">()(</span><span class="n">input_t</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span></code>
<code>      <span class="n">state</span>         <span class="o">+=</span> <span class="n">state_t</span><span class="p">(</span><span class="n">input</span><span class="p">);</span></code>
<code>      <span class="n">state_t</span> <span class="n">output</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span> <span class="o">+</span> <span class="n">half</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">K</span><span class="p">;</span></code>
<code>      <span class="n">output</span>        <span class="o">-=</span> <span class="n">zero</span> <span class="o">&gt;&gt;</span> <span class="n">K</span><span class="p">;</span></code>
<code>      <span class="n">state</span>         <span class="o">-=</span> <span class="n">output</span><span class="p">;</span></code>
<code>      <span class="k">return</span> <span class="nf">input_t</span><span class="p">(</span><span class="n">output</span><span class="p">);</span></code>
<code>    <span class="p">}</span></code>
<code></code>
<code>    <span class="k">constexpr</span> <span class="k">static</span> <span class="n">state_t</span> </code>
<code>      <span class="n">max_state</span>  <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">state_t</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">(),</span></code>
<code>      <span class="n">half_state</span> <span class="o">=</span> <span class="n">max_state</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span></code>
<code>      <span class="n">zero</span>       <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">is_unsigned</span><span class="o">&lt;</span><span class="n">input_t</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">?</span> <span class="n">state_t</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">half_state</span><span class="p">,</span></code>
<code>      <span class="n">half</span>       <span class="o">=</span> <span class="n">K</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">state_t</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="n">state_t</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></code>
<code>  </code>
<code>    <span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_unsigned</span><span class="o">&lt;</span><span class="n">state_t</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span> </code>
<code>                  <span class="s">"state type should be unsigned"</span><span class="p">);</span></code>
<code></code>
<code>    <span class="k">static_assert</span><span class="p">(</span><span class="n">max_state</span> <span class="o">&gt;=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">input_t</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">(),</span></code>
<code>                  <span class="s">"state type cannot be narrower than input type"</span><span class="p">);</span>               </code>
<code></code>
<code>    <span class="c1">/// Verify the input range to make sure it's compatible with the shift</span></code>
<code>    <span class="c1">/// factor and the width of the state type.</span></code>
<code>    <span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span></code>
<code>    <span class="k">constexpr</span> <span class="k">static</span> <span class="kt">bool</span> <span class="n">supports_range</span><span class="p">(</span><span class="n">T</span> <span class="n">min</span><span class="p">,</span> <span class="n">T</span> <span class="n">max</span><span class="p">)</span> <span class="p">{</span></code>
<code>      <span class="k">using</span> <span class="n">sstate_t</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_signed_t</span><span class="o">&lt;</span><span class="n">state_t</span><span class="o">&gt;</span><span class="p">;</span></code>
<code>      <span class="k">return</span> <span class="n">min</span> <span class="o">&lt;=</span> <span class="n">max</span> <span class="o">&amp;&amp;</span></code>
<code>             <span class="n">min</span> <span class="o">&gt;=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">input_t</span><span class="o">&gt;::</span><span class="n">min</span><span class="p">()</span> <span class="o">&amp;&amp;</span></code>
<code>             <span class="n">max</span> <span class="o">&lt;=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="n">input_t</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">()</span> <span class="o">&amp;&amp;</span></code>
<code>             <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_unsigned</span><span class="o">&lt;</span><span class="n">input_t</span><span class="o">&gt;::</span><span class="n">value</span></code>
<code>               <span class="o">?</span> <span class="n">state_t</span><span class="p">(</span><span class="n">max</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">max_state</span> <span class="o">&gt;&gt;</span> <span class="n">K</span><span class="p">)</span></code>
<code>               <span class="o">:</span> <span class="n">min</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">sstate_t</span><span class="p">(</span><span class="n">max_state</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span>  </code>
<code>                 <span class="n">max</span> <span class="o">&lt;=</span> <span class="n">sstate_t</span><span class="p">(</span><span class="n">max_state</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)));</span></code>
<code>    <span class="p">}</span></code>
<code></code>
<code>  <span class="k">private</span><span class="o">:</span></code>
<code>    <span class="n">state_t</span> <span class="n">state</span><span class="p">;</span></code>
<code><span class="p">};</span></code></pre></div>
</div>

<p>
    When the type is signed, an offset of <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="2^{B-1}"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-msubsup"><span class="mjx-base"><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">2</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span class="mjx-texatom" style=""><span class="mjx-mrow"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">B</span></span><span class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.298em; padding-bottom: 0.446em;">−</span></span><span class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.372em; padding-bottom: 0.372em;">1</span></span></span></span></span></span></span></span></span></span> is added, where <span class="mjpage"><span class="mjx-chtml"><span class="mjx-math" aria-label="B"><span class="mjx-mrow" aria-hidden="true"><span class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.446em; padding-bottom: 0.298em;">B</span></span></span></span></span></span> is the number of bits used to represent
    the state variable. This essentially shifts the value "zero" up to the middle of the range of the state.
</p>

<p>
    To check the range of the input for specific template parameters, you can use the <code>supports_range</code>
    method:
</p>

<div class="codesnippet"><style>.pygments236 .hll { background-color: #ffffcc }
.pygments236  { background: #f8f8f8; }
.pygments236 .c { color: #408080; font-style: italic } /* Comment */
.pygments236 .err { border: 1px solid #FF0000 } /* Error */
.pygments236 .k { color: #008000; font-weight: bold } /* Keyword */
.pygments236 .o { color: #666666 } /* Operator */
.pygments236 .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.pygments236 .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.pygments236 .cp { color: #BC7A00 } /* Comment.Preproc */
.pygments236 .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.pygments236 .c1 { color: #408080; font-style: italic } /* Comment.Single */
.pygments236 .cs { color: #408080; font-style: italic } /* Comment.Special */
.pygments236 .gd { color: #A00000 } /* Generic.Deleted */
.pygments236 .ge { font-style: italic } /* Generic.Emph */
.pygments236 .gr { color: #FF0000 } /* Generic.Error */
.pygments236 .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.pygments236 .gi { color: #00A000 } /* Generic.Inserted */
.pygments236 .go { color: #888888 } /* Generic.Output */
.pygments236 .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.pygments236 .gs { font-weight: bold } /* Generic.Strong */
.pygments236 .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.pygments236 .gt { color: #0044DD } /* Generic.Traceback */
.pygments236 .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.pygments236 .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.pygments236 .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.pygments236 .kp { color: #008000 } /* Keyword.Pseudo */
.pygments236 .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.pygments236 .kt { color: #B00040 } /* Keyword.Type */
.pygments236 .m { color: #666666 } /* Literal.Number */
.pygments236 .s { color: #BA2121 } /* Literal.String */
.pygments236 .na { color: #7D9029 } /* Name.Attribute */
.pygments236 .nb { color: #008000 } /* Name.Builtin */
.pygments236 .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.pygments236 .no { color: #880000 } /* Name.Constant */
.pygments236 .nd { color: #AA22FF } /* Name.Decorator */
.pygments236 .ni { color: #999999; font-weight: bold } /* Name.Entity */
.pygments236 .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.pygments236 .nf { color: #0000FF } /* Name.Function */
.pygments236 .nl { color: #A0A000 } /* Name.Label */
.pygments236 .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.pygments236 .nt { color: #008000; font-weight: bold } /* Name.Tag */
.pygments236 .nv { color: #19177C } /* Name.Variable */
.pygments236 .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.pygments236 .w { color: #bbbbbb } /* Text.Whitespace */
.pygments236 .mb { color: #666666 } /* Literal.Number.Bin */
.pygments236 .mf { color: #666666 } /* Literal.Number.Float */
.pygments236 .mh { color: #666666 } /* Literal.Number.Hex */
.pygments236 .mi { color: #666666 } /* Literal.Number.Integer */
.pygments236 .mo { color: #666666 } /* Literal.Number.Oct */
.pygments236 .sa { color: #BA2121 } /* Literal.String.Affix */
.pygments236 .sb { color: #BA2121 } /* Literal.String.Backtick */
.pygments236 .sc { color: #BA2121 } /* Literal.String.Char */
.pygments236 .dl { color: #BA2121 } /* Literal.String.Delimiter */
.pygments236 .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.pygments236 .s2 { color: #BA2121 } /* Literal.String.Double */
.pygments236 .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.pygments236 .sh { color: #BA2121 } /* Literal.String.Heredoc */
.pygments236 .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.pygments236 .sx { color: #008000 } /* Literal.String.Other */
.pygments236 .sr { color: #BB6688 } /* Literal.String.Regex */
.pygments236 .s1 { color: #BA2121 } /* Literal.String.Single */
.pygments236 .ss { color: #19177C } /* Literal.String.Symbol */
.pygments236 .bp { color: #008000 } /* Name.Builtin.Pseudo */
.pygments236 .fm { color: #0000FF } /* Name.Function.Magic */
.pygments236 .vc { color: #19177C } /* Name.Variable.Class */
.pygments236 .vg { color: #19177C } /* Name.Variable.Global */
.pygments236 .vi { color: #19177C } /* Name.Variable.Instance */
.pygments236 .vm { color: #19177C } /* Name.Variable.Magic */
.pygments236 .il { color: #666666 } /* Literal.Number.Integer.Long */
.pygments236 pre.snippet236 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/EMA-check.cpp" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments236"><pre class="lineNumbers snippet236"><code><span></span><span class="n">EMA</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">,</span> <span class="kt">int_fast16_t</span><span class="p">,</span> <span class="kt">uint_fast16_t</span><span class="o">&gt;</span> <span class="n">filter</span><span class="p">;</span></code>
<code><span class="k">static_assert</span><span class="p">(</span><span class="n">filter</span><span class="p">.</span><span class="n">supports_range</span><span class="p">(</span><span class="o">-</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1023</span><span class="p">),</span></code>
<code>              <span class="s">"use a wider state or input type, or a smaller shift factor"</span><span class="p">);</span></code></pre></div>
</div>

<h3><a name="arduino-example" href="#arduino-example">Arduino Example</a></h3>

<div class="codesnippet"><style>.pygments242 .hll { background-color: #ffffcc }
.pygments242  { background: #ffffff; }
.pygments242 .c { color: #95a5a6 } /* Comment */
.pygments242 .err { color: #a61717 } /* Error */
.pygments242 .k { color: #728E00 } /* Keyword */
.pygments242 .n { color: #434f54 } /* Name */
.pygments242 .o { color: #728E00 } /* Operator */
.pygments242 .ch { color: #95a5a6 } /* Comment.Hashbang */
.pygments242 .cm { color: #95a5a6 } /* Comment.Multiline */
.pygments242 .cp { color: #728E00 } /* Comment.Preproc */
.pygments242 .cpf { color: #95a5a6 } /* Comment.PreprocFile */
.pygments242 .c1 { color: #95a5a6 } /* Comment.Single */
.pygments242 .cs { color: #95a5a6 } /* Comment.Special */
.pygments242 .kc { color: #00979D } /* Keyword.Constant */
.pygments242 .kd { color: #728E00 } /* Keyword.Declaration */
.pygments242 .kn { color: #728E00 } /* Keyword.Namespace */
.pygments242 .kp { color: #00979D } /* Keyword.Pseudo */
.pygments242 .kr { color: #00979D } /* Keyword.Reserved */
.pygments242 .kt { color: #00979D } /* Keyword.Type */
.pygments242 .m { color: #8A7B52 } /* Literal.Number */
.pygments242 .s { color: #7F8C8D } /* Literal.String */
.pygments242 .na { color: #434f54 } /* Name.Attribute */
.pygments242 .nb { color: #728E00 } /* Name.Builtin */
.pygments242 .nc { color: #434f54 } /* Name.Class */
.pygments242 .no { color: #434f54 } /* Name.Constant */
.pygments242 .nd { color: #434f54 } /* Name.Decorator */
.pygments242 .ni { color: #434f54 } /* Name.Entity */
.pygments242 .ne { color: #434f54 } /* Name.Exception */
.pygments242 .nf { color: #D35400 } /* Name.Function */
.pygments242 .nl { color: #434f54 } /* Name.Label */
.pygments242 .nn { color: #434f54 } /* Name.Namespace */
.pygments242 .nx { color: #728E00 } /* Name.Other */
.pygments242 .py { color: #434f54 } /* Name.Property */
.pygments242 .nt { color: #434f54 } /* Name.Tag */
.pygments242 .nv { color: #434f54 } /* Name.Variable */
.pygments242 .ow { color: #728E00 } /* Operator.Word */
.pygments242 .mb { color: #8A7B52 } /* Literal.Number.Bin */
.pygments242 .mf { color: #8A7B52 } /* Literal.Number.Float */
.pygments242 .mh { color: #8A7B52 } /* Literal.Number.Hex */
.pygments242 .mi { color: #8A7B52 } /* Literal.Number.Integer */
.pygments242 .mo { color: #8A7B52 } /* Literal.Number.Oct */
.pygments242 .sa { color: #7F8C8D } /* Literal.String.Affix */
.pygments242 .sb { color: #7F8C8D } /* Literal.String.Backtick */
.pygments242 .sc { color: #7F8C8D } /* Literal.String.Char */
.pygments242 .dl { color: #7F8C8D } /* Literal.String.Delimiter */
.pygments242 .sd { color: #7F8C8D } /* Literal.String.Doc */
.pygments242 .s2 { color: #7F8C8D } /* Literal.String.Double */
.pygments242 .se { color: #7F8C8D } /* Literal.String.Escape */
.pygments242 .sh { color: #7F8C8D } /* Literal.String.Heredoc */
.pygments242 .si { color: #7F8C8D } /* Literal.String.Interpol */
.pygments242 .sx { color: #7F8C8D } /* Literal.String.Other */
.pygments242 .sr { color: #7F8C8D } /* Literal.String.Regex */
.pygments242 .s1 { color: #7F8C8D } /* Literal.String.Single */
.pygments242 .ss { color: #7F8C8D } /* Literal.String.Symbol */
.pygments242 .bp { color: #728E00 } /* Name.Builtin.Pseudo */
.pygments242 .fm { color: #D35400 } /* Name.Function.Magic */
.pygments242 .vc { color: #434f54 } /* Name.Variable.Class */
.pygments242 .vg { color: #434f54 } /* Name.Variable.Global */
.pygments242 .vi { color: #434f54 } /* Name.Variable.Instance */
.pygments242 .vm { color: #434f54 } /* Name.Variable.Magic */
.pygments242 .il { color: #8A7B52 } /* Literal.Number.Integer.Long */
.pygments242 pre.snippet242 { counter-reset: line 0; }</style>
<a href="https://github.com/tttapa/tttapa.github.io/blob/master/Pages-src/Raw-HTML/Mathematics/Systems-and-Control-Theory/Digital-filters/Exponential Moving Average/resources/EMA-Arduino.ino" title="Open on GitHub"><img class="github-mark" src="/Images/GitHub-Mark.svg"></a>
<div class="pygments242"><pre class="lineNumbers snippet242"><code><span></span><span class="n">template</span> <span class="o">&lt;</span><span class="kr">uint8_t</span> <span class="n">K</span><span class="p">,</span> <span class="kr">class</span> <span class="nc">uint_t</span> <span class="o">=</span> <span class="kr">uint16_t</span><span class="o">&gt;</span></code>
<code><span class="kr">class</span> <span class="nc">EMA</span> <span class="p">{</span></code>
<code>  <span class="kr">public</span><span class="o">:</span></code>
<code>    <span class="c1">/// Update the filter with the given input and return the filtered output.</span></code>
<code>    <span class="n">uint_t</span> <span class="kr">operator</span><span class="p">()(</span><span class="n">uint_t</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span></code>
<code>        <span class="n">state</span> <span class="o">+=</span> <span class="n">input</span><span class="p">;</span></code>
<code>        <span class="n">uint_t</span> <span class="n">output</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span> <span class="o">+</span> <span class="n">half</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">K</span><span class="p">;</span></code>
<code>        <span class="n">state</span> <span class="o">-=</span> <span class="n">output</span><span class="p">;</span></code>
<code>        <span class="k">return</span> <span class="n">output</span><span class="p">;</span></code>
<code>    <span class="p">}</span></code>
<code></code>
<code>    <span class="n">static_assert</span><span class="p">(</span></code>
<code>        <span class="n">uint_t</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">uint_t</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>  <span class="c1">// Check that `uint_t` is an unsigned type</span></code>
<code>        <span class="s">"The `uint_t` type should be an unsigned integer, otherwise, "</span></code>
<code>        <span class="s">"the division using bit shifts is invalid."</span><span class="p">);</span></code>
<code></code>
<code>    <span class="c1">/// Fixed point representation of one half, used for rounding.</span></code>
<code>    <span class="n">constexpr</span> <span class="kr">static</span> <span class="n">uint_t</span> <span class="n">half</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span></code>
<code></code>
<code>  <span class="kr">private</span><span class="o">:</span></code>
<code>    <span class="n">uint_t</span> <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></code>
<code><span class="p">};</span></code>
<code></code>
<code><span class="kr">void</span> <span class="nb">setup</span><span class="p">()</span> <span class="p">{</span></code>
<code>  <span class="nf">Serial</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span></code>
<code>  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nf">Serial</span><span class="p">);</span></code>
<code><span class="p">}</span></code>
<code></code>
<code><span class="kr">const</span> <span class="kr">unsigned</span> <span class="kr">long</span> <span class="n">interval</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span> <span class="c1">// 10000 µs = 100 Hz</span></code>
<code></code>
<code><span class="kr">void</span> <span class="nb">loop</span><span class="p">()</span> <span class="p">{</span></code>
<code>  <span class="kr">static</span> <span class="n">EMA</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span> <span class="n">filter</span><span class="p">;</span></code>
<code>  <span class="kr">static</span> <span class="kr">unsigned</span> <span class="kr">long</span> <span class="n">prevMicros</span> <span class="o">=</span> <span class="nf">micros</span><span class="p">()</span> <span class="o">-</span> <span class="n">interval</span><span class="p">;</span></code>
<code>  <span class="k">if</span> <span class="p">(</span><span class="nf">micros</span><span class="p">()</span> <span class="o">-</span> <span class="n">prevMicros</span> <span class="o">&gt;=</span> <span class="n">interval</span><span class="p">)</span> <span class="p">{</span></code>
<code>    <span class="kr">int</span> <span class="n">rawValue</span> <span class="o">=</span> <span class="nf">analogRead</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span></code>
<code>    <span class="kr">int</span> <span class="n">filteredValue</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">rawValue</span><span class="p">);</span></code>
<code>    <span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">rawValue</span><span class="p">);</span></code>
<code>    <span class="nf">Serial</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sc">'\t'</span><span class="p">);</span></code>
<code>    <span class="nf">Serial</span><span class="p">.</span><span class="nf">println</span><span class="p">(</span><span class="n">filteredValue</span><span class="p">);</span></code>
<code>    <span class="n">prevMicros</span> <span class="o">+=</span> <span class="n">interval</span><span class="p">;</span></code>
<code>  <span class="p">}</span></code>
<code><span class="p">}</span></code></pre></div>
</div>

<h3><a name="additional-resources" href="#additional-resources">Additional resources</a></h3>

<p>
    The idea to use a constant offset to deal with negative inputs originated in
    <a href="https://forum.pjrc.com/threads/61941-Exponential-Moving-Average-How-does-it-work">this PJRC forum
        thread</a>. It also includes a discussion about how the filter works, simulations comparing integer EMA
    implementations with and without rounding, a pure C implementation, etc.
</p>

</div>
        <hr id="end-of-article">
        <div class="nextupprev"><div class="prevpage"><a href="Filtering-in-MATLAB.html" title="Filtering in MATLAB"><i class="material-icons" style="vertical-align: middle; text-decoration: none">chevron_left </i>Previous Page</a></div><div class="uppage"><a href="index.html" title="Exponential Moving Average">Index</a></div><div class="nextpage"></div></div>
    </article>
    <footer>Last edited: Thursday, 23 July 2020 13:54 UTC</footer>


</body></html>